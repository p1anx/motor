# TCP/UART应用 - 同步开关功能

## 功能概述

已成功为同步控制功能添加了独立的开关控制，每个同步信息输入框前都有一个开关按键，只有在开启后才能发送或接收对应的同步信息。

## 🎯 新功能特性

### 四个独立开关
1. **TCP发送开关** (红色) - 控制是否发送TCP同步字符串
2. **TCP接收开关** (绿色) - 控制是否接收TCP同步确认
3. **UART发送开关** (红色) - 控制是否发送UART同步字符串
4. **UART接收开关** (绿色) - 控制是否接收UART同步确认

### 界面布局
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 同步控制页面 - 增强的开关控制功能                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ TCP同步字符串:                                                              │
│ ┌─────────────┐ ┌─────────────────────────────────────────────────────┐    │
│ │ 启用发送   │ │ SYNC_SEND (发送的同步字符串)                        │    │
│ │ (红色)     │ │                                                     │    │
│ └─────────────┘ └─────────────────────────────────────────────────────┘    │
│ ┌─────────────┐ ┌─────────────────────────────────────────────────────┐    │
│ │ 启用接收   │ │ SYNC_RECV (接收的同步字符串)                        │    │
│ │ (绿色)     │ │                                                     │    │
│ └─────────────┘ └─────────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────────────────────┤
│ UART同步字符串:                                                             │
│ ┌─────────────┐ ┌─────────────────────────────────────────────────────┐    │
│ │ 启用发送   │ │ SYNC_SEND (发送的同步字符串)                        │    │
│ │ (红色)     │ │                                                     │    │
│ └─────────────┘ └─────────────────────────────────────────────────────┘    │
│ ┌─────────────┐ ┌─────────────────────────────────────────────────────┐    │
│ │ 启用接收   │ │ SYNC_RECV (接收的同步字符串)                        │    │
│ │ (绿色)     │ │                                                     │    │
│ └─────────────┘ └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 🔧 开关功能

### 发送开关控制
- **TCP发送开关**: 控制是否发送TCP同步字符串
- **UART发送开关**: 控制是否发送UART同步字符串
- **关闭效果**: 不会发送对应的同步字符串，显示"同步已禁用"消息

### 接收开关控制
- **TCP接收开关**: 控制是否接收TCP同步确认
- **UART接收开关**: 控制是否接收UART同步确认
- **关闭效果**: 不会检查对应的同步确认，不影响同步完成判断

## 🎨 界面特色

### 开关设计
- **发送开关**: 红色复选框，表示发送功能
- **接收开关**: 绿色复选框，表示接收功能
- **默认状态**: 所有开关默认开启
- **视觉反馈**: 清晰的颜色编码

### 输入框状态
- **启用状态**: 开关开启时，输入框正常显示和编辑
- **禁用状态**: 开关关闭时，输入框变灰且不可编辑
- **样式变化**: 自动应用禁用样式

## 📊 控制逻辑

### 同步发送控制
```python
# 检查TCP发送开关
if self.sync_page.tcp_send_enable_check.isChecked():
    # 发送TCP同步字符串
    self.tcp_thread.send_data(tcp_sync_send + '\n')
else:
    # 显示发送已禁用消息
    self.add_tcp_display_text("[同步] TCP发送同步已禁用")
```

### 同步接收控制
```python
# 检查TCP接收开关
if self.sync_page.tcp_recv_enable_check.isChecked():
    # 检查同步确认
    if tcp_sync_recv in pure_content:
        self.tcp_sync_received = True
```

### 同步完成判断
```python
# 只检查开启的接收开关
if tcp_connected and self.sync_page.tcp_recv_enable_check.isChecked():
    if not self.tcp_sync_received:
        sync_complete = False
```

## 🔧 技术实现

### 核心组件
- **QCheckBox**: 四个独立的开关控件
- **事件处理**: 开关状态变化处理
- **样式控制**: 输入框启用/禁用状态
- **逻辑控制**: 同步发送和接收控制

### 事件处理方法
```python
def on_tcp_send_enable_toggled(self, checked):
    """TCP发送同步开关处理"""
    self.tcp_sync_send_input.setEnabled(checked)
    if not checked:
        self.tcp_sync_send_input.setStyleSheet("background-color: #ecf0f1; color: #95a5a6;")
    else:
        self.tcp_sync_send_input.setStyleSheet("")
```

### 状态管理
- **开关状态**: 实时跟踪每个开关的状态
- **输入框状态**: 根据开关状态启用/禁用
- **同步逻辑**: 根据开关状态控制同步行为

## 📋 使用场景

### 1. 只需要TCP同步
- 关闭UART发送和接收开关
- 只使用TCP进行同步

### 2. 只需要UART同步
- 关闭TCP发送和接收开关
- 只使用UART进行同步

### 3. 只需要发送同步
- 关闭所有接收开关
- 只发送同步字符串，不等待确认

### 4. 只需要接收同步
- 关闭所有发送开关
- 只接收同步确认，不发送同步字符串

### 5. 灵活配置
- 任意组合的同步设置
- 满足各种同步需求

## 🚀 优势特性

### 精确控制
- **独立控制**: 每个同步功能独立控制
- **灵活配置**: 任意组合的同步设置
- **精确管理**: 精确控制同步行为

### 用户体验
- **视觉清晰**: 颜色编码的状态指示
- **操作简单**: 直观的开关控制
- **状态反馈**: 实时的状态变化

### 功能完整
- **覆盖全面**: 覆盖所有同步场景
- **逻辑清晰**: 清晰的控制逻辑
- **扩展性强**: 易于扩展新功能

## 🔍 调试和测试

### 测试脚本
```bash
# 同步开关功能测试
python test_sync_switches.py

# 功能演示
python demo_sync_switches.py
```

### 测试步骤
1. 进入同步控制页面
2. 观察四个开关的状态和样式
3. 关闭某个发送开关，测试同步发送
4. 关闭某个接收开关，测试同步接收
5. 观察输入框的启用/禁用状态
6. 观察同步过程的日志输出

### 常见问题
1. **开关无响应**: 检查事件连接
2. **输入框状态异常**: 检查样式设置
3. **同步逻辑错误**: 检查开关状态判断
4. **界面显示异常**: 检查布局和样式

## 📈 更新日志

### v2.4 - 同步开关功能
- ✅ 添加四个独立的同步开关
- ✅ 实现发送和接收的独立控制
- ✅ 优化界面布局和样式
- ✅ 完善同步逻辑控制
- ✅ 增强用户体验

### 主要改进
- **精确控制**: 每个同步功能独立控制
- **灵活配置**: 任意组合的同步设置
- **视觉优化**: 颜色编码的状态指示
- **逻辑完善**: 清晰的同步控制逻辑

---

这个同步开关功能为您的TCP/UART应用提供了更精确和灵活的同步控制能力，可以满足各种复杂的同步需求，操作更加直观和便捷。
